{% extends 'members_app/inc/master.html' %}
{% load static %}
{% load data_handler_tags %}
{% block title %}
{{ title }} - Session
{% endblock title %}

{% block customcss %}

<link href="{% static 'assets/plugins/custom/jqvmap/jqvmap.bundle.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'assets/plugins/custom/datatables/datatables.bundle.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'assets/plugins/custom/prismjs/prismjs.bundle.css' %}" rel="stylesheet" type="text/css" />
{% endblock customcss %}

{% block pagename %}
{% if get_user_membership.data_file_obj.data_handler_session_label == "" %}
UNNAMED SESSION!
{% else %}
{{get_user_membership.data_file_obj.data_handler_session_label}}

{% endif %}
{% endblock pagename %}

{% block content %}



<div class="container">
    <!--begin:: Alert-->
    <div class="alert alert-custom alert-light-primary fade show mb-5 text-center" role="alert">
        <div class="alert-text lead">
            <p class="font-weight-bolder" style="margin-bottom: 2px;">
                Predictive Model Dashboard
            </p>
            <!-- <p class="font-weight-bolder">
            Best fit model name:
        </p> -->

            <p class="font-weight-bolder">
                {% for item in model_output_data.model_name %}
                {{ item|get_model_name_dashboard }} <br />
                {% endfor %}
            </p>

            <p>
                <!-- {{extracted_data.donation_columns|get_cols}} -->
            </p>


        </div>

    </div>
    <!--end:: Alert-->
    <!--Begin::Row-->
    <div class="row">

        <div class="col-xl-4 col-lg-4">


            <!--begin:: Widgets/Revenue Change-->
            <div class="card card-custom gutter-b">
                <div class="card-header">
                    <div class="card-title">
                        <h3 class="card-label">
                            Train/Test Set
                        </h3>

                    </div>
                </div>
                <div class="card-body">
                    <!-- <span class="text-muted mb-3 d-inline-block">
                        Model Accuracy breakdown by cities
                    </span> -->
                    <!--begin::Chart-->
                    <div id="session_dashboard_training_testing_chart" class="d-flex justify-content-center"></div>
                    <!--end::Chart-->
                </div>
            </div>

            <!--end:: Widgets/Revenue Change-->
        </div>



        <div class="col-xl col-lg">
            {% if not donation_info.all_info %}
            {# in case no donation columns for this session #}
            <div class="card card-custom gutter-b bg-diagonal bg-diagonal-light-warning">
                <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between p-4 flex-lg-wrap flex-xl-nowrap">
                        <div class="d-flex flex-column mr-5">
                            <p class="h4 text-dark text-hover-primary mb-5">
                                No Donation Columns.
                            </p>
                            <p class="text-dark-50">
                                You do not pick donation columns before run the model for this session
                            </p>
                        </div>
                        <div class="ml-6 ml-lg-0 ml-xxl-6 flex-shrink-0">
                            <!-- <button class="btn font-weight-bolder text-uppercase btn-warning py-4 px-6">
                            Start Chat
                        </button> -->
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
            {# in case donation columns exists for this session #}
            <div class="card card-custom gutter-b">
                <div class="card-header">
                    <div class="card-title">
                        <h3 class="card-label">
                            Data Summary
                        </h3>
                    </div>
                </div>

                <div class="card-body text-left" style="overflow-x: auto;">
                    <div class="table-responsive">
                        <table class="table table-hover mb-6">
                            <thead>
                                <tr>
                                    <th scope="col">Donation Columns</th>
                                    <th scope="col">Total Records</th>
                                    <th scope="col">Total Donation</th>
                                    <th scope="col">Average</th>
                                    <th scope="col">Max</th>
                                    <th scope="col">Min</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for key, value in donation_info.all_info.items %}
                                <tr scope='row'>
                                    <td>
                                        <strong>
                                            {{key}}
                                        </strong>
                                    </td>
                                    <td>
                                        <strong>
                                            {{value.total_records}}
                                        </strong>
                                    </td>
                                    <td>
                                        <strong>
                                            ${{value.total_donation}}
                                        </strong>
                                    </td>
                                    <td>
                                        <strong>
                                            ${{value.mean_value}}
                                        </strong>
                                    </td>
                                    <td>
                                        <strong>
                                            ${{value.max_value}}
                                        </strong>
                                    </td>
                                    <td>
                                        <strong>
                                            ${{value.min_value}}
                                        </strong>
                                    </td>
                                </tr>
                                {% endfor %}


                            </tbody>
                        </table>
                    </div>
                </div>


            </div>
            {% endif %}



        </div>
    </div>

    <!--End::Row-->

    <!-- Start Row -->
    <div class="row text-center mb-6">

        <div class="col">

            <div class="card">
                <div class="card-header">
                    <header>
                        <h3 data-toggle="collapse" data-target="#categoricalCollapse" aria-expanded="false"
                            aria-controls="categoricalCollapse">
                            Categorical Data
                        </h3>
                    </header>
                </div>
                <div class="card-body" style="overflow-x: auto; white-space: nowrap;">
                    <div class="collapse show active" id="categoricalCollapse">
                        <div class="card card-body">
                            <div class="d-flex flex-row">
                                {% for item in model_output_data.categorical_data_features %}
                                <div class="mx-2">
                                    <button type="button" class="btn btn-primary font-weight-bold btn-pill">
                                        {{ item }}
                                    </button>
                                </div>
                                {% endfor %}
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Row -->

    <!-- Start Row -->
    <div class="row text-center mb-6">

        <div class="col">

            <div class="card">
                <div class="card-header">
                    <header>
                        <h3>
                            KPIs
                        </h3>
                    </header>
                </div>
                <div class="card-body" style="overflow-x: auto; white-space: nowrap;">
                    <div class="row">
                        <div class="col">
                            <div class="alert alert-custom alert-light-dark fade show mb-5" role="alert">

                                <div class="alert-text">
                                    <h3 class="font-weight-boldest">
                                        Donors Predicted
                                    </h3>
                                    <h4 class="font-weight-boldest">
                                        {{ model_output_data.donors_predicted }}
                                    </h4>
                                </div>

                            </div>
                        </div>
                        <div class="col">
                            <div class="alert alert-custom alert-light-primary fade show mb-5" role="alert">

                                <div class="alert-text">
                                    <h3 class="font-weight-boldest text-dark">
                                        Accuracy (F1-Score)
                                    </h3>
                                    <h4 class="font-weight-boldest text-dark">
                                        {{ model_output_data.f1_score }}
                                    </h4>
                                </div>

                            </div>
                        </div>
                        <div class="col">
                            <div class="alert alert-custom alert-light-warning bg-warning-o-50 fade show mb-5"
                                role="alert">

                                <div class="alert-text">
                                    <h3 class="font-weight-boldest text-dark">
                                        Threshold (Cut-off) Value
                                    </h3>
                                    <h4 class="font-weight-boldest text-dark">
                                        {{ model_output_data.threshold }}
                                    </h4>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Row -->

    <!--Begin::Row-->
    <div class="row">

        <div class="col-xl-6 col-lg-6">

            <div class="card card-custom gutter-b">
                <div class="card-header">
                    <div class="card-title">
                        <h3 class="card-label">Important Features</h3>
                    </div>
                </div>
                <div class="card-body">
                    <!--begin::Chart-->
                    <div id="session_dashboard_important_features_chart" class="d-flex justify-content-center"></div>
                    <!--end::Chart-->
                </div>
            </div>
            <!--end::Card-->
        </div>



        <div class="col-xl-6 col-lg-6">
            <!--begin::Card-->
            <!--begin::Card-->
            <div class="card card-custom gutter-b">
                <div class="card-header">
                    <div class="card-title">
                        <h3 class="card-label">Donor Penetration</h3>
                    </div>
                </div>
                <div class="card-body">
                    <div id="kt_jqvmap_world" class="jqvmap" style="height:300px;"></div>
                </div>
            </div>
            <!--end::Card-->
            <!--end::Card-->
        </div>
    </div>

    <!--End::Row-->
</div>



{% endblock content%}


{% block customjs %}

<script src="{% static 'assets/js/pages/widgets.js' %}"></script>

<script src="{% static 'assets/js/custom/members_app/dashboard_apexcharts.js' %}"></script>
<script src="{% static 'assets/js/custom/members_app/dashboard_jqvmap.js' %}"></script>
<script src="{% static 'assets/plugins/custom/datatables/datatables.bundle.js' %}"></script>
<script src="{% static 'assets/js/custom/djangocookie.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/js/pages/widgets.js' %}"></script>
<!-- Custom Script of data handler list page -->
<script src="{% static 'assets/js/custom/members_app/helpers.js' %}"></script>
<script src="{% static 'assets/js/custom/members_app/apis.js' %}"></script>
<script src="{% static 'assets/js/custom/members_app/members.js' %}"></script>

{% endblock customjs %}